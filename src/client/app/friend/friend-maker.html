<!-- Header -->
<header id="header" class="container">
    <h1>Friendship Tracker</h1>
    <!--<p class="lead">-->
        <!--This is deployed with the <code>#grid</code> div fluid (that is, it has no Bootstrap <code>.container</code> class). To make it fixed simply add the <code>.container</code> class to it. Use the media queries in <strong>style.css</strong> to change the grid's post widths and margins.-->
    <!--</p>-->
    <hr>
</header>

<!-- Form -->
<div class="col-xs-12">
    <div class="well bs-component">
        <form class="form-horizontal">
            <fieldset>
                <div class="form-group">
                    <label for="" class="col-lg-2 control-label">Firstname</label>
                    <div class="col-lg-10">
                        <input type="text" class="form-control" id="inputEmail" placeholder="Firstname" ng-model="user.first">
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-lg-2 control-label">Lastname</label>
                    <div class="col-lg-10">
                        <input type="text" class="form-control" id="inputEmail" placeholder="Lastname" ng-model="user.last">
                    </div>
                </div>

                <div class="form-group">
                    <label for="" class="col-lg-2 control-label">Personal Blurb</label>
                    <div class="col-lg-10">
                        <textarea class="form-control" rows="3" id="textArea" ng-model="user.blurb"></textarea>
                        <span class="help-block">Just a little about you...</span>
                    </div>
                </div>

                <div class="togglebutton col-lg-10 col-lg-offset-2">
                    <label>
                        <input type="checkbox"><span class="toggle"></span> Choose Your Avatar
                    </label>
                </div>
                <br/>
                <br/>
                <div class="form-group">
                            <label class="col-lg-2 control-label"></label>
                            <div class="col-lg-10 offset-2">
                                <div class="radio radio-primary col-lg-3 pull-left">
                                    <label>
                                        <div class="panel panel-primary">
                                            <div class="panel-heading">
                                                <h3 class="panel-title">Mouse #1</h3>
                                            </div>
                                            <div class="panel-body">
                                                <img src="/app/img/mouse1.jpg" alt=""/>
                                                <input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked="" ng-model="user.img.mouse1"><span class="circle"></span><span class="check"></span>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                                <div class="radio radio-primary col-lg-3 pull-left">
                                    <label>
                                        <div class="panel panel-success">
                                            <div class="panel-heading">
                                                <h3 class="panel-title">Mouse #2</h3>
                                            </div>
                                            <div class="panel-body">
                                                <img src="/app/img/mouse2.jpg" alt=""/>
                                                <input type="radio" name="optionsRadios" id="optionsRadios1" value="option2" ng-model="user.img.mouse2"><span class="circle"></span><span class="check"></span>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                                <div class="radio radio-primary col-lg-3 pull-left">
                                    <label>
                                        <div class="panel panel-warning">
                                            <div class="panel-heading">
                                                <h3 class="panel-title">Mouse #3</h3>
                                            </div>
                                            <div class="panel-body">
                                                <img src="/app/img/mouse3.jpg" alt=""/>
                                                <input type="radio" name="optionsRadios" id="optionsRadios1" value="option3"  ng-model="user.img.mouse3"><span class="circle"></span><span class="check"></span>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                                <div class="radio radio-primary col-lg-3 pull-left">
                                    <label>
                                        <div class="panel panel-info">
                                            <div class="panel-heading">
                                                <h3 class="panel-title">Mouse #4</h3>
                                            </div>
                                            <div class="panel-body">
                                                <img src="/app/img/mouse4.jpg" alt=""/>
                                                <input type="radio" name="optionsRadios" id="optionsRadios1" value="option4"  ng-model="user.img.mouse4"><span class="circle"></span><span class="check"></span>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                <div class="form-group">
                    <div class="col-lg-10 col-lg-offset-2">
                        <button type="submit" class="btn btn-large btn-primary" ng-click='vm.addUser(user)'>Submit</button>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>

<!-- Grid -->
<div class="col-xs-12">
    <div id="grid">
        <div id="posts">
            <div class="post" ng-repeat="p in vm.personsData.people">
                <img class="circle" src="/app/img/{{p.img}}" alt="icon">
                <h4 class="list-group-item-heading">{{p.first}} {{p.last}}</h4>
                <p class="list-group-item-text">{{p.blurb}}</p>
            </div>
        </div>
    </div>
</div>

<script>
    // TODO: Put Masonry into the Bower build
    // Load is used to ensure all images have been loaded, impossible with document
    jQuery(window).load(function () {
        setTimeout(function(){
            // Takes the gutter width from the bottom margin of .post
            var gutter = parseInt(jQuery('.post').css('marginBottom'));
            var container = jQuery('#posts');

            // Creates an instance of Masonry on #posts
            container.masonry({
                gutter: gutter,
                itemSelector: '.post',
                columnWidth: '.post'
            });

            // This code fires every time a user resizes the screen and only affects .post elements
            // whose parent class isn't .container. Triggers resize first so nothing looks weird.
            jQuery(window).bind('resize', function () {
                if (!jQuery('#posts').parent().hasClass('container')) {
                    // Resets all widths to 'auto' to sterilize calculations
                    post_width = jQuery('.post').width() + gutter;
                    jQuery('#posts, body > #grid').css('width', 'auto');
                    // Calculates how many .post elements will actually fit per row. Could this code be cleaner?
                    posts_per_row = jQuery('#posts').innerWidth() / post_width;
                    floor_posts_width = (Math.floor(posts_per_row) * post_width) - gutter;
                    ceil_posts_width = (Math.ceil(posts_per_row) * post_width) - gutter;
                    posts_width = (ceil_posts_width > jQuery('#posts').innerWidth()) ? floor_posts_width : ceil_posts_width;
                    if (posts_width == jQuery('.post').width()) {
                        posts_width = '100%';
                    }
                    // Ensures that all top-level elements have equal width and stay centered
                    jQuery('#posts, #grid').css('width', posts_width);
                    jQuery('#grid').css({'margin': '0 auto'});
                }

            }).trigger('resize');
        },1000);
    });
</script>